.PHONY: clean

OCAMLPACKS[] =
	unix

OCAMLFLAGS += -g -dtypes -w A

O_FILES[] =
	eventloop
	net_events
	async_conn
	conn_map
	unix_poller
	epoll_poller

C_FILES[] =
	epoll_stubs

LIB = eventloop

epoll_poller.$(CMO) epoll_poller.o : epoll_stubs.o

epoll_stubs.o: epoll_stubs.c
	$(OCAMLC) -c -o $@ $^

OCAML_LIB_FLAGS += $(absname $(addsuffix .o, $(C_FILES)))

.DEFAULT: $(OCamlLibrary $(LIB), $(O_FILES))

clean:
	$(CLEAN)
